CREATE DATABASE CAR_RENTAL_DB;
USE CAR_RENTAL_DB;

-- User Info
CREATE TABLE USER_DETAILS (
    USER_ID INT AUTO_INCREMENT PRIMARY KEY,
    FIRST_NAME VARCHAR(50) NOT NULL,
    LAST_NAME VARCHAR(50) NOT NULL,
    GENDER ENUM('MALE', 'FEMALE') NOT NULL,
    EMAIL VARCHAR(150) UNIQUE NOT NULL,
    PHONE VARCHAR(20) UNIQUE NOT NULL,
    ADDRESS VARCHAR(255) NOT NULL,
    ROLE ENUM('customer', 'admin', 'rental-agent') DEFAULT 'customer',
    CREATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- User Login Accounts
CREATE TABLE USER_ACCOUNT (
    ACCOUNT_ID INT AUTO_INCREMENT PRIMARY KEY,
    USER_ID INT NOT NULL,
    PASSWORD VARCHAR(255) NOT NULL,
    STATUS ENUM('ACTIVE', 'INACTIVE') DEFAULT 'ACTIVE',
    CREATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (USER_ID) REFERENCES USER_DETAILS(USER_ID) ON DELETE CASCADE
);

-- Car Info
CREATE TABLE CAR_DETAILS (
    CAR_ID INT AUTO_INCREMENT PRIMARY KEY,
    CAR_NAME VARCHAR(50) NOT NULL,
    COLOR VARCHAR(50) NOT NULL,
    THUMBNAIL_PATH VARCHAR(255),
    CAPACITY TINYINT NOT NULL,
    STATUS ENUM('AVAILABLE', 'RESERVED', 'RENTED', 'MAINTENANCE', 'SALVAGE') DEFAULT 'AVAILABLE',
    PRICE DECIMAL(10,2) NOT NULL,
    CREATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- Customer Bookings
CREATE TABLE CUSTOMER_BOOKING_DETAILS (
    BOOKING_ID INT AUTO_INCREMENT PRIMARY KEY,
    USER_ID INT NOT NULL,
    CAR_ID INT NOT NULL,
    PICKUP_DATE DATETIME NOT NULL,
    DROP_OFF_DATE DATETIME NOT NULL,
    TRIP_DETAILS VARCHAR(255) NULL,   
    STATUS ENUM('PENDING','CANCELED','FOR VERIFICATION','FOR PICKUP','ONGOING','EXTENDED','CHECKING','COMPLETED') DEFAULT 'PENDING',
    TOTAL_COST DECIMAL(10,2) NOT NULL,
    CREATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (USER_ID) REFERENCES USER_DETAILS(USER_ID) ON DELETE CASCADE,
    FOREIGN KEY (CAR_ID) REFERENCES CAR_DETAILS(CAR_ID) ON DELETE CASCADE
);

-- Payments
CREATE TABLE BOOKING_PAYMENT_DETAILS (
    PAYMENT_DETAILS_ID INT AUTO_INCREMENT PRIMARY KEY,
    RECEIPT_PATH VARCHAR(255) NOT NULL,
    BOOKING_ID INT NOT NULL,
    PAYMENT_TYPE ENUM('BOOKING FEE', 'PENALTY') DEFAULT 'BOOKING FEE',
    CREATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (BOOKING_ID) REFERENCES CUSTOMER_BOOKING_DETAILS(BOOKING_ID) ON DELETE CASCADE
);

CREATE TABLE BOOKING_VEHICLE_INSPECTION(
    INSPECTION_ID INT AUTO_INCREMENT PRIMARY KEY,
    BOOKING_ID INT NOT NULL,
    IMAGE_PATH VARCHAR(255) NOT NULL,
    CREATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (BOOKING_ID) REFERENCES CUSTOMER_BOOKING_DETAILS(BOOKING_ID) ON DELETE CASCADE
);